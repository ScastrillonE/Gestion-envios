{% extends 'core/base/base.html' %}
{%load static%}
{% block extra_css %}
<!--datetimepicker-->
<link rel="stylesheet" href="{% static 'lib/bootstrap-datetimepicker/css/bootstrap-datepicker.standalone.css'%} ">

{%endblock%}
{% block content %}
<div class="card-body">
    <div class="col-md-12 row">
        <div class="col-md-4">
            Desde:
            <input type="text" name="f1" id="f1" class="form-class" readonly>
        </div>
        <div class="col-md-4">
            Hasta:
            <input type="text" name="f2" id="f2" class="form-class" readonly>
        </div>
        <div class="col-md-4">
            <button class="btn btn-warning" id="report">Generar reporte</button>
        </div>
    </div>
</div>
<div class="card-body">
    <div class="row">
        <a href="{% url 'create_shipping' %}" class="btn btn-success mb-3"><i class="fa fa-plus"></i> Agregar nuevo
            envío</a>
    </div>
</div>
<table id="tableShipping" class="table" data-search="true"
       data-pagination="true">

    <thead>
    <tr>
        <th data-field="id">Id</th>
        <th data-field="consecutivo">Consecutivo</th>
        <th data-field="cust.name">Cliente</th>
        <th data-field="c_Tdocument">T.Documento</th>
        <th data-field="c_document">Documento</th>
        <th data-field="shipping_number">N.Guia</th>
        <th data-field="c_address">Direccion</th>
        <th data-field="departamento.nombre">Departamento</th>
        <th data-field="municip.nombre">Municipio</th>
        <th data-field="c_phone">Telefono</th>
        <th data-field="c_cel">Celular</th>
        <th data-field="shipping_company">Empresa</th>
<!--        <th data-field="photo">Foto</th>-->
        <th>Opciones</th>
    </tr>
    </thead>
</table>

<!--Modal for list extra data -->
<div class="modal" id="extraTable" tabindex="-1" role="dialog" aria-labelledby="title" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="title"><font style="vertical-align: inherit;"><font
                        style="vertical-align: inherit;">Info envio</font></font></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true"><font style="vertical-align: inherit;"><font
                        style="vertical-align: inherit;">×</font></font></span>
                </button>
            </div>

            <div class="modal-body">
                <table id="" class="table">

                    <thead>
                    <tr>
                        <th>Fecha de envio</th>
                        <th>Estado</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr id="datosextra">

                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

{%endblock%}

{%block extra_js%}
<script src="{% static 'js/functions.js' %}"></script>
<!--datetimepicker-->
<script src="{% static 'lib/bootstrap-datetimepicker/js/bootstrap-datepicker.min.js' %}" ></script>
<script>
$(document).ready(function(){
    var $table = $('#tableShipping');

    $("#f1,#f2").datepicker({
        language: "es",
        todayBtn: "linked",
        format: "yyyy-mm-dd",
        todayHighlight: true,
    });

    $("#report").on('click', function (e){
        e.preventDefault();
        var f1,f2;
        f1 = $("#f1").val();
        f2 = $("#f2").val();

        if(f1=="" || f1 == null){
            var d = new Date();
            var f1 = d.getFullYear() + "-" + (d.getMonth()+1) + "-" + d.getDate();

        }
        if(f2=="" || f2 == null){
            var d = new Date();
            var f2 = d.getFullYear() + "-" + (d.getMonth()+1) + "-" + d.getDate();
        }
        var url = "/reporte/"+ f1 + "/" + f2;
        window.open(url);
    });

    $.ajax({
       url: window.location.pathname,
       type: "GET",
       dataType:"json",
    }).done(function(data){
        $table.bootstrapTable({
            data: data,
            columns:[{
                field: 'Id',
                title:'Id',
                formatter: function (value, row, index) {
                    return row.id
                }
            },{
                field: 'Consecutivo',
                title:'Consecutivo',
                formatter: function (value, row, index) {
                    return row.consecutivo
                }
            },{
                field: 'Cliente',
                title:'Cliente',
                formatter: function (value, row, index) {
                    return row.cust.name
                }
            },{
                field: 'T_document',
                title:'T.Documento',
                formatter: function (value, row, index) {
                    return row.c_Tdocument
                }
            },{
                field: 'c_document',
                title:'Documento',
                formatter: function (value, row, index) {
                    return row.c_document
                }
            },{
                field: 'n_guia',
                title:'N.Guia',
                formatter: function (value, row, index) {
                    return row.shipping_number
                }
            },{
                field: 'address',
                title:'Direccion',
                formatter: function (value, row, index) {
                    return row.c_address
                }
            },{
                field: 'department',
                title:'Departamento',
                formatter: function (value, row, index) {
                    return row.departamento.nombre
                }
            },{
                field: 'municipio',
                title:'Municipio',
                formatter: function (value, row, index) {
                    return row.municip.nombre
                }
            },{
                field: 'phone',
                title:'Phone',
                formatter: function (value, row, index) {
                    return row.c_phone
                }
            },{
                field: 'cel',
                title:'Celular',
                formatter: function (value, row, index) {
                    return row.c_cel
                }
            },{
                field: 'shipping_company',
                title:'Empresa envio',
                formatter: function (value, row, index) {
                    return row.s_company
                }
            },{
             field: 'Opciones',
             title:'Opciones',
             formatter: function (value, row, index) {
                        var buttons = '<div class=row>'+'<a href="/shipping/' + row.id + '/"class="btn btn-warning mr-1"><i class="fa fa-pencil-square"></i></a>';
                        buttons += '<a href="/shipping/delete/' + row.id + '/"class="btn btn-danger"><i class="fa fa-trash-o"></i></a>'+ '</div>';
                        buttons += '<a href="/create/pdf/' + row.id + '/"class="btn btn-primary ml-1"><i class="fa fa-print"></i></a>'+'</div>';

                        return buttons;
               }
            }],
        })

    });







});


</script>

{%endblock%}